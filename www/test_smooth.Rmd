---
title: "Test smooth.R"
author: "W. Bauer"
date: "September 8, 2015"
output: html_document
---

```{r}
source("../R/smooth.R")
source("../R/system_matrix_utils.R")
library(Matrix)
```

Construct a test image

```{r fig.show='hold'}
ap <- read.table("../data/acoustic_properties_thigh.csv", sep=',', header=TRUE, as.is=TRUE)
img <- testImage(24,8,1,1/1450) # fat background
img[4:14, 2:5] <- 1/1585  # muscle
img[19:20, 6:7] <- 1/1584 # vessel
img[1, 1:8] <- 1/1660   # skin
img[24, 1:8] <- 1/1660  # skin
plotTestImage(img)
gridOverlay(img)
ys <- probeYs(8, img)
probeOverlay(ys, img, col=c("black", "white"))
M <- genS(8,24,1)
tau <- M %*% as.vector(img)
```


```{r}
H <- formH(8, 24)
V <- formV(8, 24)
HTH <- t(H) %*% H
VTV <- t(V) %*% V
MTM <- t(M) %*% M
bhat <- solve(MTM + 1.0*(HTH+VTV), t(M) %*% tau)
ihat <- as.testImage(matrix(bhat, 24, 8), 1)
plotTestImage(ihat, main="1.0")
bhat2 <- solve(MTM + .10*(HTH+VTV), t(M) %*% tau)
ihat2 <- as.testImage(matrix(bhat2, 24, 8), 1)
plotTestImage(ihat2, main="1e-1")
bhat3 <- solve(MTM + 1e-2*(HTH+VTV), t(M) %*% tau)
ihat3 <- as.testImage(matrix(bhat3, 24, 8), 1)
plotTestImage(ihat3, main="1e-2")
bhat4 <- solve(MTM + 1e-6*(HTH+VTV), t(M) %*% tau)
ihat4 <- as.testImage(matrix(bhat4, 24, 8), 1)
plotTestImage(ihat4, main="1e-6")
```

